<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="604px" preserveAspectRatio="none" style="width:622px;height:604px;background:#FFFFFF;" version="1.1" viewBox="0 0 622 604" width="622px" zoomAndPan="magnify"><defs/><g><ellipse cx="261.75" cy="20" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1.0;"/><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="132" x="195.75" y="50"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="112" x="205.75" y="71.1387">Request comes in</text><polygon fill="#F1F1F1" points="169.75,103.9688,353.75,103.9688,365.75,115.9688,353.75,127.9688,169.75,127.9688,157.75,115.9688,169.75,103.9688" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="184" x="169.75" y="119.7769">Is RemoteAddr in TrustedPeers?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="143.75" y="113.3745">no</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="20" x="365.75" y="113.3745">yes</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="215" x="11" y="137.9688"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="195" x="21" y="159.1074">Return RemoteAddr as client IP</text><ellipse cx="118.5" cy="202.9375" fill="none" rx="11" ry="11" style="stroke:#222222;stroke-width:1.0;"/><ellipse cx="118.5" cy="202.9375" fill="#222222" rx="6" ry="6" style="stroke:#111111;stroke-width:1.0;"/><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="318" x="246" y="137.9688"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="298" x="256" y="159.1074">Check headers (e.g. X-Forwarded-For, X-Real-IP)</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="201" x="304.5" y="191.9375"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="181" x="314.5" y="213.0762">Parse header list (if present)</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="161" x="324.5" y="289.9063"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="141" x="334.5" y="311.0449">Take next IP from right</text><polygon fill="#F1F1F1" points="338,343.875,472,343.875,484,355.875,472,367.875,338,367.875,326,355.875,338,343.875" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="134" x="338" y="359.6831">Is IP in TrustedProxies?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="20" x="306" y="353.2808">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="484" y="353.2808">no</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="100" x="266" y="377.875"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="80" x="276" y="399.0137">Continue left</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="176" x="406" y="377.875"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="156" x="416" y="399.0137">Return this IP as client IP</text><ellipse cx="494" cy="442.8438" fill="none" rx="11" ry="11" style="stroke:#222222;stroke-width:1.0;"/><ellipse cx="494" cy="442.8438" fill="#222222" rx="6" ry="6" style="stroke:#111111;stroke-width:1.0;"/><polygon fill="#F1F1F1" points="405,245.9063,417,257.9063,405,269.9063,393,257.9063,405,245.9063" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#F1F1F1" points="385.5,473.8438,424.5,473.8438,436.5,485.8438,424.5,497.8438,385.5,497.8438,373.5,485.8438,385.5,473.8438" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="39" x="385.5" y="489.6519">IPs left</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="270" x="270" y="517.8438"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="250" x="280" y="538.9824">If all IPs are trusted, return RemoteAddr</text><ellipse cx="405" cy="582.8125" fill="none" rx="11" ry="11" style="stroke:#222222;stroke-width:1.0;"/><ellipse cx="405" cy="582.8125" fill="#222222" rx="6" ry="6" style="stroke:#111111;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="261.75" x2="261.75" y1="30" y2="50"/><polygon fill="#181818" points="257.75,40,261.75,50,265.75,40,261.75,44" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="118.5" x2="118.5" y1="171.9375" y2="191.9375"/><polygon fill="#181818" points="114.5,181.9375,118.5,191.9375,122.5,181.9375,118.5,185.9375" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="405" x2="405" y1="171.9375" y2="191.9375"/><polygon fill="#181818" points="401,181.9375,405,191.9375,409,181.9375,405,185.9375" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="494" x2="494" y1="411.8438" y2="431.8438"/><polygon fill="#181818" points="490,421.8438,494,431.8438,498,421.8438,494,425.8438" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="326" x2="316" y1="355.875" y2="355.875"/><line style="stroke:#181818;stroke-width:1.0;" x1="316" x2="316" y1="355.875" y2="377.875"/><polygon fill="#181818" points="312,367.875,316,377.875,320,367.875,316,371.875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="484" x2="494" y1="355.875" y2="355.875"/><line style="stroke:#181818;stroke-width:1.0;" x1="494" x2="494" y1="355.875" y2="377.875"/><polygon fill="#181818" points="490,367.875,494,377.875,498,367.875,494,371.875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="316" x2="316" y1="411.8438" y2="458.8438"/><line style="stroke:#181818;stroke-width:1.0;" x1="316" x2="405" y1="458.8438" y2="458.8438"/><line style="stroke:#181818;stroke-width:1.0;" x1="405" x2="405" y1="458.8438" y2="473.8438"/><polygon fill="#181818" points="401,463.8438,405,473.8438,409,463.8438,405,467.8438" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="405" x2="405" y1="323.875" y2="343.875"/><polygon fill="#181818" points="401,333.875,405,343.875,409,333.875,405,337.875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="405" x2="405" y1="269.9063" y2="289.9063"/><polygon fill="#181818" points="401,279.9063,405,289.9063,409,279.9063,405,283.9063" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="436.5" x2="596" y1="485.8438" y2="485.8438"/><polygon fill="#181818" points="592,384.875,596,374.875,600,384.875,596,380.875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="596" x2="596" y1="257.9063" y2="485.8438"/><line style="stroke:#181818;stroke-width:1.0;" x1="596" x2="417" y1="257.9063" y2="257.9063"/><polygon fill="#181818" points="427,253.9063,417,257.9063,427,261.9063,423,257.9063" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="405" x2="405" y1="225.9063" y2="245.9063"/><polygon fill="#181818" points="401,235.9063,405,245.9063,409,235.9063,405,239.9063" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="405" x2="405" y1="497.8438" y2="517.8438"/><polygon fill="#181818" points="401,507.8438,405,517.8438,409,507.8438,405,511.8438" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="405" x2="405" y1="551.8125" y2="571.8125"/><polygon fill="#181818" points="401,561.8125,405,571.8125,409,561.8125,405,565.8125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="157.75" x2="118.5" y1="115.9688" y2="115.9688"/><line style="stroke:#181818;stroke-width:1.0;" x1="118.5" x2="118.5" y1="115.9688" y2="137.9688"/><polygon fill="#181818" points="114.5,127.9688,118.5,137.9688,122.5,127.9688,118.5,131.9688" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="365.75" x2="405" y1="115.9688" y2="115.9688"/><line style="stroke:#181818;stroke-width:1.0;" x1="405" x2="405" y1="115.9688" y2="137.9688"/><polygon fill="#181818" points="401,127.9688,405,137.9688,409,127.9688,405,131.9688" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="261.75" x2="261.75" y1="83.9688" y2="103.9688"/><polygon fill="#181818" points="257.75,93.9688,261.75,103.9688,265.75,93.9688,261.75,97.9688" style="stroke:#181818;stroke-width:1.0;"/><!--MD5=[cebac77e30119436e6c57cd23578648b]
@startuml
start
:Request comes in;
if (Is RemoteAddr in TrustedPeers?) then (no)
  :Return RemoteAddr as client IP;
  stop
else (yes)
  :Check headers (e.g. X-Forwarded-For, X-Real-IP);
  :Parse header list (if present);
  repeat
    :Take next IP from right;
    if (Is IP in TrustedProxies?) then (yes)
      :Continue left;
    else (no)
      :Return this IP as client IP;
      stop
    endif
  repeat while (IPs left)
  :If all IPs are trusted, return RemoteAddr;
  stop
endif
@enduml

PlantUML version 1.2022.7(Mon Aug 22 17:01:30 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>